---
# tasks file for zabbix_agent
- name: Install repository
  ansible.builtin.yum:
    name: "{{ zabbix_repo_url }}"
    state: present

- name: Install zabbix-agent
  ansible.builtin.yum:
    name: zabbix-agent-4.3.1
    state: present

- name: configure zabbix-agent
  ansible.builtin.lineinfile:
    dest: "/etc/zabbix/zabbix_agentd.conf"
    regexp: "{{ item.regexp }}"
    line: "{{ item.line }}"
  with_items:
    - { regexp: "^ServerActive=", line: "ServerActive={{ zabbix_server }}" }
    - { regexp: "^Server=", line: "Server={{ zabbix_server }}" }
  notify: "Restart zabbix-agent"